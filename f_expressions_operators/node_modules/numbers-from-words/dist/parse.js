"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const U = tslib_1.__importStar(require("./utils"));
const errors_1 = require("./errors");
const types_1 = require("./types");
const const_1 = require("./const");
/**
 * Parses a string defining a number with words into its numeric value.
 *
 * @throws {@link InvalidInputError}
 * This exception is thrown if the input is invalid.
 *
 * @param input - The string to parse.
 * @returns The numeric value of the input.
 *
 * @example
 * Here are some example invocations:
 * ```
 * const ... = parse('twenty')
 * const ... = parse('one hundred and twenty three')
 * const ... = parse('one thousand, two hundred and thirty four')
 * ```
 *
 * @example
 * Here are some example invocations that throw an exception:
 * ```
 * parse('in 2 hours and 3 minutes ago')
 * parse('a month in the past')
 * ```
 *
 * @public
 */
const parse = (input) => {
    const words = input.replace(/-/g, ' ').split(' ');
    let result = 0;
    let currentMultiple = null;
    let currentQuantity = null;
    for (let i = 0; i < words.length; i++) {
        const word = words[i].toLowerCase().replace(/\W/g, '');
        if (word === 'and') {
            if (currentQuantity !== null) {
                result += currentQuantity;
                currentQuantity = null;
            }
            continue;
        }
        const capitalizedWord = U.capitalize(word);
        if (const_1.MULTIPLES_WORDS.includes(capitalizedWord)) {
            if (currentMultiple !== null) {
                throw new errors_1.InvalidInputError(input, 'parsed two multiples in a row');
            }
            else if (currentQuantity !== null) {
                throw new errors_1.InvalidInputError(input, 'parsed a number before a multiple');
            }
            currentMultiple = types_1.Multiples[capitalizedWord];
        }
        else if (const_1.NUMBER_WORDS.includes(capitalizedWord)) {
            const value = types_1.Numbers[capitalizedWord];
            if (currentQuantity !== null) {
                throw new errors_1.InvalidInputError(input, 'parsed two numbers in a row');
            }
            if (currentMultiple !== null) {
                result += currentMultiple + value;
                currentMultiple = null;
            }
            else {
                currentQuantity = value;
            }
        }
        else if (const_1.MAGNITUDE_WORDS.includes(capitalizedWord)) {
            const value = types_1.Magnitudes[capitalizedWord];
            if (currentQuantity === null) {
                throw new errors_1.InvalidInputError(input, 'parsed magnitude without number');
            }
            result += currentQuantity * value;
            currentQuantity = null;
            currentMultiple = null;
        }
    }
    if (currentQuantity !== null) {
        result += currentQuantity;
    }
    else if (currentMultiple !== null) {
        result += currentMultiple;
    }
    return result;
};
exports.default = parse;
